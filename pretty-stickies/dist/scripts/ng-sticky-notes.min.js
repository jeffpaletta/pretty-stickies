!function(){"use strict";angular.module("ngStickyNotes",["ngCookies","LocalStorageModule","ui.sortable","pascalprecht.translate","firebase"]).config(["$translateProvider","EN_US","localStorageServiceProvider",function(t,e,n){t.translations("en-US",e),t.preferredLanguage("en-US"),t.useSanitizeValueStrategy(null),n.setPrefix("ngStickyNotes")}])}(),function(){"use strict";angular.module("ngStickyNotes").directive("ngStickyNotesNew",function(){return{scope:{color:"@"},templateUrl:"scripts/components/ngStickyNotesNew/ngStickyNotesNew.html",controller:["$scope","sharedNotes","$rootScope",function(t,e,n){t["new"]=function(e){t.color&&(e.color=t.color),n.$broadcast("ngStickyNotes.New",e)}}]}})}(),function(){"use strict";angular.module("ngStickyNotes").directive("ngStickyNotesClean",function(){return{templateUrl:"scripts/components/ngStickyNotesClean/ngStickyNotesClean.html",controller:["$scope","sharedNotes","$rootScope",function(t,e,n){t.removeAll=function(){n.$broadcast("ngStickyNotes.RemoveAll")}}]}})}(),function(){"use strict";angular.module("ngStickyNotes").directive("ngStickyNotes",function(){return{scope:{headerMaxLength:"=",contentMaxLength:"=",readonlyEnabled:"=?",dragAndDropEnabled:"=?",outDropEnabled:"=?",magneticEffectEnabled:"=?"},templateUrl:"scripts/components/ngStickyNotes/ngStickyNotes.html",controller:["$scope","sharedNotes","$timeout","notesStatus",function(t,e,n,o){function r(){e.load().then(function(e){t.styckyNotes=e||[]})}function i(n){t.readonlyEnabled||e.remove(n).then(function(){r()})}function c(n){t.readonlyEnabled||e.update(n)}function s(){angular.forEach(t.styckyNotes,function(t,e){t.order!==e&&(t.order=e,c(t))})}function a(){t.sortableOptions.disabled=t.readonlyEnabled||!t.dragAndDropEnabled}r(),t.save=function(t){c(t)},t.remove=i,t.toFront=function(e){if(t.dragAndDropEnabled&&t.outDropEnabled){var n=_.indexOf(t.styckyNotes,e);-1!==n&&(t.styckyNotes.splice(n,1),t.styckyNotes.push(e),s())}},t.sortableOptions={disabled:!t.dragAndDropEnabled,opacity:.8,cursor:"move",start:function(){o.setIsInEditMode(!0)},beforeStop:function(e,n){if(t.outDropEnabled){var o={position:"absolute",top:n.position.top,left:n.position.left},r=$(n.item);r.css(o);var i=r.data("id"),s=_.findWhere(t.styckyNotes,{id:i});s&&(s.style=o,c(s))}},stop:function(t,e){$(e.item).css("z-index",""),o.setIsInEditMode(!1)},update:function(e,o){if(t.outDropEnabled&&t.magneticEffectEnabled){var r={position:"inherit"},i=$(o.item);i.css(r);var a=i.data("id"),l=_.findWhere(t.styckyNotes,{id:a});l&&(l.style=r,c(l))}n(s)}},a(),t.$watch("readonlyEnabled",function(t){a()}),t.$watch("dragAndDropEnabled",function(t){a()});var l=t.$on("ngStickyNotes.New",function(n,o){t.readonlyEnabled||e.add(o).then(function(){r()})}),u=t.$on("ngStickyNotes.Remove",function(t,e){i(e)}),d=t.$on("ngStickyNotes.RemoveAll",function(){t.readonlyEnabled||e.removeAll().then(function(){r()})}),f=t.$on("ngStickyNotes.Refresh",function(){r()});t.$on("$destroy",function(){l(),u(),d(),f()})}]}})}(),function(){"use strict";angular.module("ngStickyNotes").directive("ngStickyItem",["notesStatus",function(t){return{scope:{headerMaxLength:"=",contentMaxLength:"=",context:"=",readonlyEnabled:"=?",onChange:"&",onRemove:"&"},templateUrl:"scripts/components/ngStickyItem/ngStickyItem.html",controller:["$scope","$element","$timeout",function(e,n,o){function r(){e.onChange({stickyItem:e.context})}function i(){t.setIsInEditMode(e.isEditHeaderMode||e.isEditContentMode)}function c(t){return 13===t||9===t}function s(t){return $("<div>").html(t).text().replace(/\n/gi,"<br/>")}function a(t){return _.forEach(l,function(e){t&&(t=e(t))}),t}e.isEditHeaderMode=!1,e.isEditContentMode=!1,i(),e.editHeader=function(){e.readonlyEnabled||(e.isEditHeaderMode=!0,i(),o(function(){n.find("h2").find("input")[0].focus()}))},e.saveHeader=function(t){e.isEditHeaderMode=!1,t||i(),r()},e.onHeaderEnter=function(t){c(t.keyCode)&&(e.saveHeader(!1),e.editContent(t))},e.onContentEnter=function(t){!c(t.keyCode)||t.ctrlKey||t.altKey||t.shiftKey||e.saveContent()},e.editContent=function(t){$(t.target).is(".clickable")||e.readonlyEnabled||(e.isEditContentMode=!0,i(),o(function(){n.find("p").find("textarea")[0].focus()}))},e.saveContent=function(t){e.isEditContentMode=!1,t||i(),r()},e.remove=function(){e.onRemove({stickyItem:e.context})},e.getStyle=function(){return e.context&&e.context.color?{background:e.context.color}:{}};var l=[function(t){return s(t)},function(t){return t.replace(/\[([^\]]+)\]\(([^\)]+)\)/gim,function(t,e,n){if(_.isNull(e)||_.isUndefined(e)||_.isEmpty(e))return t;if(_.isNull(n)||_.isUndefined(n)||_.isEmpty(n))return t;var o=$("<a>").attr("href",n).attr("target","blank").text(e).addClass("clickable");return $("<div>").append(o).html()})}];e.$watch("context.text",function(t){n[0].getElementsByClassName("text-renderer")[0].innerHTML=a(t)})}]}}])}(),function(){"use strict";angular.module("ngStickyNotes").service("sharedNotes",["notesStorage","colorsPaletteProvider","$q","$timeout","dataCloud","notesStatus",function(t,e,n,o,r,i){function c(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function s(t){var e=c();t.id=e}function a(t){N++,t.order=N}function l(t){t.color=e.nextColor()}function u(){return E&&0===_.size(t.keys())?d():n.when({})}function d(){return r.load().then(function(e){return _.forEach(e,function(e){t.set(e.id,{title:e.title,text:e.text,date:e.date||new Date,color:e.color,order:e.order,style:e.style})}),n.when({})})}function f(){_.size(t.keys())>0&&y(g()).then(function(){t.clearAll()},function(){})}function g(){return v()}function y(t){return r.load().then(function(e){var o=e?JSON.stringify(e):"",i=t?JSON.stringify(t):"";return o!==i?r.save(t):n.when(t)})}function h(){return E&&0===_.size(t.keys())?r.save(null):n.when()}function m(t,e){var n=i.getIsInEditMode();return n||t(),o(function(){m(t,e)},e)}function v(){var e=[];return _.forEach(t.keys(),function(n){var o=t.get(n);o=_.extend({},o,{id:n}),o.order>N&&(N=o.order),e.push(o)}),_.sortBy(e,function(t){return t.order})}var k=this,p=t.getConfig(),S=p.SYNC_INTERVAL,E=!!S;E&&m(f,S),this.add=function(t){return s(t),a(t),t.color||l(t),k.update(t)},this.update=function(e){return u().then(function(){return t.set(e.id,{title:e.title,text:e.text,date:e.date||new Date,color:e.color,order:e.order,style:e.style}),n.when(e)})},this.remove=function(e){return d().then(function(){return t.remove(e.id),0===_.size(t.keys)?h():n.when({})})},this.removeAll=function(){return t.clearAll(),h()};var N=0;this.load=function(){return!E||_.size(t.keys())>0?n.when(v()):r.load()}}])}(),function(){"use strict";angular.module("ngStickyNotes").provider("notesStorage",function(){var t={cookieKey:null};this.setConfig=function(e){t=e},this.$get=["localStorageService","$cookies",function(e,n){function o(){return t.cookieKey?n.get(t.cookieKey):null}function r(t){var e=o();return e?[t,e].join(c):t}function i(t,e){var n=e||o();if(n){var r=c+n,i=t.lastIndexOf(r);return-1===i||i+r.length!==t.length?null:t.substr(0,i)}return-1!==t.lastIndexOf(c)?null:t}var c="|@:",s={};return s.set=function(t,n){return e.set(r(t),n)},s.remove=function(t){return e.remove(r(t))},s.clearAll=function(t){t?e.clearAll():_.forEach(s.keys(),s.remove)},s.keys=function(){for(var t=[],n=e.keys(),r=o(),c=0,s=n.length;s>c;c++){var a=i(n[c],r);a&&t.push(a)}return t},s.get=function(t){return e.get(r(t))},s.getConfig=function(){return t},s}]})}(),function(){"use strict";angular.module("ngStickyNotes").service("notesStatus",function(){var t=!1;this.getIsInEditMode=function(){return t},this.setIsInEditMode=function(e){t=!!e}})}(),function(){"use strict";angular.module("ngStickyNotes").service("dataCloud",["notesStorage","$cookies","$q","$rootScope",function(t,e,n,o){var r=t.getConfig(),i=e.get(r.cookieKey||"")||"NONE",c=r.fireURL;if(!c)return this.load=function(){return n.when([])},void(this.save=function(){return n.when({})});var s=new Firebase(c);s.child(i).on("value",function(){o.$broadcast("ngStickyNotes.Refresh")}),this.load=function(){var t=n.defer();return s.child(i).once("value",function(e){t.resolve(e.val())}),t.promise},this.save=function(t){var e=n.defer();return s.child(i).once("value",function(n){var o={};o[i]=t,n.ref().parent().update(o),e.resolve(t)}),e.promise}}])}(),function(){"use strict";angular.module("ngStickyNotes").provider("colorsPaletteProvider",function(){var t=["#ffc","#cfc","#ccf"];this.setCustomColors=function(e){t=e},this.$get=function(){var e=-1;return{nextColor:function(){return e++,t.length===e&&(e=0),t[e]}}}})}(),function(){"use strict";var t={STICKY_NOTES:{TITLE:"Title",TEXT:"Text",REMOVE:"Remove",ADD:"Add a new note",CLEAN:"Clean"}};angular.module("ngStickyNotes").constant("EN_US",t)}(),angular.module("ngStickyNotes").run(["$templateCache",function(t){t.put("scripts/components/ngStickyItem/ngStickyItem.html",'<div class="ng-sticky-item" ng-style="getStyle()">\r\n    <div class="ng-sticky-item-header">\r\n        <button type="button" ng-show="!readonlyEnabled" class="remove ng-sticky-notes-button" ng-click="remove()" title="{{\'STICKY_NOTES.REMOVE\'|translate}}"><i class="fa fa-remove"></i></button>\r\n    </div>\r\n    <div class="ng-sticky-item-content">\r\n        <div ng-show="!isEditHeaderMode" ng-click="editHeader()" title="{{context.title}}">\r\n            <h2 ng-show="context.title && context.title.length > 0">{{context.title}}</h2>\r\n            <h2 ng-show="!context.title || context.title.length === 0" class="watermark">{{\'STICKY_NOTES.TITLE\'|translate}}</h2>\r\n        </div>\r\n        <h2 ng-show="isEditHeaderMode">\r\n            <input type="text" placeholder="{{\'STICKY_NOTES.TITLE\'|translate}}" ng-model="context.title" ng-blur="saveHeader();"\r\n                   ng-keydown="onHeaderEnter($event)"\r\n                   ng-maxlength="headerMaxLength" maxlength="{{headerMaxLength}}"/>\r\n        </h2>\r\n\r\n        <div class="editable-form" ng-show="!isEditContentMode" ng-click="editContent($event)" title="{{context.text}}">\r\n            <p ng-show="context.text && context.text.length > 0" class="text-renderer"></p>\r\n            <p ng-show="!context.text || context.text.length === 0" class="watermark">{{\'STICKY_NOTES.TEXT\'|translate}}</p>\r\n        </div>\r\n        <p ng-show="isEditContentMode">\r\n            <textarea ng-model="context.text" rows="3" placeholder="{{\'STICKY_NOTES.TEXT\'|translate}}" ng-blur="saveContent();"\r\n                      ng-keydown="onContentEnter($event)"\r\n                      ng-maxlength="contentMaxLength" maxlength="{{contentMaxLength}}"></textarea>\r\n        </p>\r\n    </div>\r\n    <div class="ng-sticky-item-footer">\r\n        <p>\r\n            {{context.date | date:\'medium\'}}\r\n        </p>\r\n    </div>\r\n</div>'),t.put("scripts/components/ngStickyNotes/ngStickyNotes.html",'<div class="ng-sticky-notes">\r\n    <ul class="ng-sticky-item-list" ui-sortable="sortableOptions" ng-model="styckyNotes">\r\n        <li ng-style="outDropEnabled && stickyItem.style" ng-dblclick="toFront(stickyItem)" data-id="{{stickyItem.id}}" class="ng-sticky-item-list-item" ng-repeat="stickyItem in styckyNotes">\r\n            <ng-sticky-item header-max-length="headerMaxLength"\r\n                            content-max-length="contentMaxLength"\r\n                            readonly-enabled="readonlyEnabled"\r\n                            context="stickyItem"\r\n                            on-change="save(stickyItem)"\r\n                            on-remove="remove(stickyItem)">\r\n            </ng-sticky-item>\r\n        </li>\r\n    </ul>\r\n    <div style="clear: both"></div>\r\n</div>'),t.put("scripts/components/ngStickyNotesClean/ngStickyNotesClean.html",'<button type="button" class="ng-sticky-notes-button" ng-click="removeAll()">\r\n    <i class="fa fa-trash"></i>\r\n    {{\'STICKY_NOTES.CLEAN\'|translate}}\r\n</button>'),t.put("scripts/components/ngStickyNotesNew/ngStickyNotesNew.html",'<button type="button" class="ng-sticky-notes-button" ng-click="new({})" ng-style="{color: color}">\r\n    <i class="fa fa-plus-circle"></i>\r\n    {{\'STICKY_NOTES.ADD\'|translate}}\r\n</button>')}]);